<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<org.eventb.core.machineFile org.eventb.core.comment="&#10;&#9;This machine introduces the level of access that each record in&#10;&#9;My Health Record can have. There are three levels: General, Restrited&#10;&#9;and Hidden. The access is&#10;&#10;&#9;* Owner can access records marked as General and Restricted&#10;&#9;* Service Providers with General Access can access records marked as General&#10;&#9;* Service Providers with Restricted Access can access records marked as General and Restricted&#10;&#9;* No one can see records marked as Hidden&#10;&#9;* Service Providers with revoked Access have no access to records&#10;&#9;TODO: express those constraints as invariants&#10;&#10;" org.eventb.core.configuration="org.eventb.core.fwd" org.eventb.core.generated="false" org.eventb.texttools.text_lastmodified="1583916868991" org.eventb.texttools.text_representation="machine ref4_level_access_record&#10;/*&#10;&#9;This machine introduces the level of access that each record in&#10;&#9;My Health Record can have. There are three levels: General, Restrited&#10;&#9;and Hidden. The access is&#10;&#10;&#9;* Owner can access records marked as General and Restricted&#10;&#9;* Service Providers with General Access can access records marked as General&#10;&#9;* Service Providers with Restricted Access can access records marked as General and Restricted&#10;&#9;* No one can see records marked as Hidden&#10;&#9;* Service Providers with revoked Access have no access to records&#10;&#9;TODO: express those constraints as invariants&#10;&#10;*/&#10;refines ref3_level_access_sp  sees ctx_ref2&#10;&#10;variables my_health_report_DB consumer&#10;          my_MHR // REFINEMENT 1&#10;          records // the set of records in the system&#10;          records_mhr // maps a record to the My Health Report it belongs to&#10;          consumer_own_records&#10;          /* maps a consumer to their records&#10;             REFINEMENT 2 */&#10;          service_providers // set of registered service providers&#10;          consumer_sp // maps consumers to Service Providers&#10;          access_sp_mhr // models the access of Service Providers to My Health Records&#10;          staff // list of staff (e.g. doctors, nurses)&#10;          staff_sp&#10;          /* maps staff to the Service Providers they work on&#10;             REFINEMENT 3 */&#10;          general_access_list_sp // maps Health Service Providers with 'General Access' to My Health Record&#10;          restricted_access_list_sp // maps Health Service Providers with 'Restricted Access' to My Health Record&#10;          revoked_list_sp // maps Health Service Providers whose access have been revoked to My Health Record&#10;          //REFINEMENT 4&#10;          record_general_list // models the list of General Access records&#10;          record_restricted_list // models the list of Restricted Access records&#10;          record_hidden_list // models the list of Hidden records&#10;&#10;invariants&#10;&#9;@inv1_r4 record_general_list ∈ records ⇸ my_health_report_DB&#10;&#9;@inv2_r4 record_restricted_list ∈ records ⇸ my_health_report_DB&#10;&#9;@inv3_r4 record_hidden_list ∈ records ⇸ my_health_report_DB&#10;&#9;@inv4_r4 partition(records_mhr, record_general_list, record_restricted_list, record_hidden_list)&#10;&#10;&#10;events&#10;  event INITIALISATION extends INITIALISATION&#10;  then&#10;  &#9;@act1_r4 record_general_list ≔ ∅&#10;&#9;@act2_r4 record_restricted_list ≔ ∅&#10;&#9;@act3_r4 record_hidden_list ≔ ∅&#10;  end&#10;&#10;  event opt_in&#10;  /* Any person can opt in the system. When this happens, a new My Health Record is&#10;     set, initially empty. The new consumer can populate the Record with the last&#10;     2 year of activities. This part is not modelled as it does not concer the&#10;     access of privacy&#10;      */&#10;  extends opt_in&#10;  end&#10;&#10;  event opt_out&#10;  /* A user of the system can decide, at any time, to opt-out the system.&#10;     If this happens, all records their My Health Report are deleted (permanently),&#10;     the My Health Recodr and the user are deleted from the system.&#10;      */&#10;  extends opt_out&#10;  then&#10;  &#9;@act1_r4 record_general_list ≔ record_general_list ⩥ {my_MHR(c)}&#10;&#9;@act2_r4 record_restricted_list ≔ record_restricted_list ⩥ {my_MHR(c)}&#10;&#9;@act3_r4 record_hidden_list ≔ record_hidden_list ⩥ {my_MHR(c)}&#10;  end&#10;&#10;  event view_record_owner&#10;  /* Access a specific record 'r' by 'c' to view it.&#10;     This is an action over the record&#10;      */&#10;  extends view_record_owner&#10;  where&#10;  &#9;@grd1_r4 r↦my_MHR(c) ∉ record_hidden_list&#10;  end&#10;&#10;  event delete_record&#10;  /* It deletes an existing record (only if it is the owner)&#10;     This is an action over the My Health Report system&#10;      */&#10;  extends delete_record&#10;  then&#10;  &#9;@act1_r4 record_general_list ≔ {r} ⩤ record_general_list&#10;&#9;@act2_r4 record_restricted_list ≔ {r} ⩤ record_restricted_list&#10;&#9;@act3_r4 record_hidden_list ≔ {r} ⩤ record_hidden_list&#10;  end&#10;&#10;  event upload_record_owner&#10;  /* It uploads a new record. It belongs to 'ow'&#10;     This is an action over the My Health Report system.&#10;      */&#10;  extends upload_record_owner&#10;  then&#10;  &#9;@act1_r4 record_general_list ≔ record_general_list ∪ {r↦my_MHR(ow)}&#10;  end&#10;&#10;  event upload_record_staff&#10;  /* models a staff uploading a new record. It belongs to 'ow'&#10;     This is an action over the My Health Report system.&#10;      */&#10;  extends upload_record_staff&#10;  end&#10;&#10;  event add_consumer_sp&#10;  /* Adds a consumer to a Service Provider.&#10;     This is an action of the System&#10;      */&#10;  extends add_consumer_sp&#10;  end&#10;&#10;  event view_general_record_staff&#10;  /* Access to a specific record 'r' by a staff.&#10;      */&#10;  extends view_record_staff&#10;  where&#10;  &#9;@grd1_r4 r∈dom(record_general_list)&#10;  &#9;@grd2_r4 sp↦record_general_list(r) ∈ general_access_list_sp&#10;  end&#10;&#10;  event view_restricted_record_staff&#10;  /* Access to a specific record 'r' by a staff.&#10;      */&#10;  extends view_record_staff&#10;  where&#10;  &#9;@grd1_r4 r∈dom(record_restricted_list)&#10;  &#9;@grd2_r4 sp↦record_general_list(r) ∈ general_access_list_sp ∨ sp↦record_general_list(r) ∈ restricted_access_list_sp&#10;  end&#10;&#10;  event add_staff_sp&#10;  /* This event add a staff to a Service Provider&#10;      */&#10;  extends add_staff_sp&#10;  end&#10;&#10;  event add_sp&#10;  /* Adds a new Service Provider to the system&#10;      */&#10;  extends add_sp&#10;  end&#10;&#10;  event revoke_access_sp&#10;  /* revoke access to a Service Provider&#10;     TODO: enforce&#10;      */&#10;  extends revoke_access_sp&#10;  end&#10;&#10;  event give_restricted_access_sp&#10;  /* Gives restricted access to a Service Provider&#10;     TODO: enforce&#10;      */&#10;  extends give_restricted_access_sp&#10;  end&#10;&#10;  event give_general_access_sp&#10;  /* Gives general access to a Service Provider&#10;     TODO: enforce&#10;      */&#10;  extends give_general_access_sp&#10;  end&#10;end&#10;" version="5">
<org.eventb.core.refinesMachine name="'" org.eventb.core.target="ref3_level_access_sp"/>
<org.eventb.core.seesContext name="_2Hi1YGAkEeqDMsFs4V7FUQ" org.eventb.core.target="ctx_ref2"/>
<org.eventb.core.variable name="_IqG0s19AEeqDMsFs4V7FUQ" org.eventb.core.generated="false" org.eventb.core.identifier="my_health_report_DB"/>
<org.eventb.core.variable name="_IqG0tF9AEeqDMsFs4V7FUQ" org.eventb.core.generated="false" org.eventb.core.identifier="consumer"/>
<org.eventb.core.variable name="_GOfb8F9CEeqDMsFs4V7FUQ" org.eventb.core.comment="REFINEMENT 1" org.eventb.core.generated="false" org.eventb.core.identifier="my_MHR"/>
<org.eventb.core.variable name="_ai0bUF9DEeqDMsFs4V7FUQ" org.eventb.core.comment="the set of records in the system" org.eventb.core.generated="false" org.eventb.core.identifier="records"/>
<org.eventb.core.variable name="_ai0bUV9DEeqDMsFs4V7FUQ" org.eventb.core.comment="maps a record to the My Health Report it belongs to" org.eventb.core.generated="false" org.eventb.core.identifier="records_mhr"/>
<org.eventb.core.variable name="_f3GGcF9FEeqDMsFs4V7FUQ" org.eventb.core.comment="maps a consumer to their records&#10;             REFINEMENT 2 " org.eventb.core.generated="false" org.eventb.core.identifier="consumer_own_records"/>
<org.eventb.core.variable name="_cSVVcGAlEeqDMsFs4V7FUQ" org.eventb.core.comment="set of registered service providers" org.eventb.core.generated="false" org.eventb.core.identifier="service_providers"/>
<org.eventb.core.variable name="_cSVVcWAlEeqDMsFs4V7FUQ" org.eventb.core.comment="maps consumers to Service Providers" org.eventb.core.generated="false" org.eventb.core.identifier="consumer_sp"/>
<org.eventb.core.variable name="_qLJhkGA0EeqDMsFs4V7FUQ" org.eventb.core.comment="models the access of Service Providers to My Health Records" org.eventb.core.generated="false" org.eventb.core.identifier="access_sp_mhr"/>
<org.eventb.core.variable name="_vpLwMGA3EeqDMsFs4V7FUQ" org.eventb.core.comment="list of staff (e.g. doctors, nurses)" org.eventb.core.generated="false" org.eventb.core.identifier="staff"/>
<org.eventb.core.variable name="_NNjusGKWEeqDMsFs4V7FUQ" org.eventb.core.comment="maps staff to the Service Providers they work on&#10;             REFINEMENT 3 " org.eventb.core.generated="false" org.eventb.core.identifier="staff_sp"/>
<org.eventb.core.variable name="_itFtwGMXEeqDMsFs4V7FUQ" org.eventb.core.comment="maps Health Service Providers with 'General Access' to My Health Record" org.eventb.core.generated="false" org.eventb.core.identifier="general_access_list_sp"/>
<org.eventb.core.variable name="_itFtwWMXEeqDMsFs4V7FUQ" org.eventb.core.comment="maps Health Service Providers with 'Restricted Access' to My Health Record" org.eventb.core.generated="false" org.eventb.core.identifier="restricted_access_list_sp"/>
<org.eventb.core.variable name="_itFtwmMXEeqDMsFs4V7FUQ" org.eventb.core.comment="maps Health Service Providers whose access have been revoked to My Health Record&#10;REFINEMENT 4" org.eventb.core.generated="false" org.eventb.core.identifier="revoked_list_sp"/>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUR" org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="INITIALISATION">
<org.eventb.core.action name="_esCVsGNwEeqfwL_WG7Gltw" org.eventb.core.assignment="record_general_list ≔ ∅" org.eventb.core.generated="false" org.eventb.core.label="act1_r4"/>
<org.eventb.core.action name="_esCVsWNwEeqfwL_WG7Gltw" org.eventb.core.assignment="record_restricted_list ≔ ∅" org.eventb.core.generated="false" org.eventb.core.label="act2_r4"/>
<org.eventb.core.action name="_esCVsmNwEeqfwL_WG7Gltw" org.eventb.core.assignment="record_hidden_list ≔ ∅" org.eventb.core.generated="false" org.eventb.core.label="act3_r4"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUS" org.eventb.core.comment="Any person can opt in the system. When this happens, a new My Health Record is&#10;     set, initially empty. The new consumer can populate the Record with the last&#10;     2 year of activities. This part is not modelled as it does not concer the&#10;     access of privacy&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="opt_in">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="opt_in"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUT" org.eventb.core.comment="A user of the system can decide, at any time, to opt-out the system.&#10;     If this happens, all records their My Health Report are deleted (permanently),&#10;     the My Health Recodr and the user are deleted from the system.&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="opt_out">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="opt_out"/>
<org.eventb.core.action name="_P-whkGNzEeqLVsYI4ayt8A" org.eventb.core.assignment="record_general_list ≔ record_general_list ⩥ {my_MHR(c)}" org.eventb.core.generated="false" org.eventb.core.label="act1_r4"/>
<org.eventb.core.action name="_P-xIoGNzEeqLVsYI4ayt8A" org.eventb.core.assignment="record_restricted_list ≔ record_restricted_list ⩥ {my_MHR(c)}" org.eventb.core.generated="false" org.eventb.core.label="act2_r4"/>
<org.eventb.core.action name="_P-xIoWNzEeqLVsYI4ayt8A" org.eventb.core.assignment="record_hidden_list ≔ record_hidden_list ⩥ {my_MHR(c)}" org.eventb.core.generated="false" org.eventb.core.label="act3_r4"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUU" org.eventb.core.comment="Access a specific record 'r' by 'c' to view it.&#10;     This is an action over the record&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="view_record_owner">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="view_record_owner"/>
<org.eventb.core.guard name="_SDargGN0EeqLVsYI4ayt8A" org.eventb.core.generated="false" org.eventb.core.label="grd1_r4" org.eventb.core.predicate="r↦my_MHR(c) ∉ record_hidden_list"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUV" org.eventb.core.comment="It deletes an existing record (only if it is the owner)&#10;     This is an action over the My Health Report system&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="delete_record">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="delete_record"/>
<org.eventb.core.action name="_jBmgYGNzEeqLVsYI4ayt8A" org.eventb.core.assignment="record_general_list ≔ {r} ⩤ record_general_list" org.eventb.core.generated="false" org.eventb.core.label="act1_r4"/>
<org.eventb.core.action name="_6s_swGN1EeqLVsYI4ayt8A" org.eventb.core.assignment="record_restricted_list ≔ {r} ⩤ record_restricted_list" org.eventb.core.generated="false" org.eventb.core.label="act2_r4"/>
<org.eventb.core.action name="_6s_swWN1EeqLVsYI4ayt8A" org.eventb.core.assignment="record_hidden_list ≔ {r} ⩤ record_hidden_list" org.eventb.core.generated="false" org.eventb.core.label="act3_r4"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUW" org.eventb.core.comment="It uploads a new record. It belongs to 'ow'&#10;     This is an action over the My Health Report system.&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="upload_record_owner">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="upload_record_owner"/>
<org.eventb.core.action name="_6s_swmN1EeqLVsYI4ayt8A" org.eventb.core.assignment="record_general_list ≔ record_general_list ∪ {r↦my_MHR(ow)}" org.eventb.core.generated="false" org.eventb.core.label="act1_r4"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUX" org.eventb.core.comment="models a staff uploading a new record. It belongs to 'ow'&#10;     This is an action over the My Health Report system.&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="upload_record_staff">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="upload_record_staff"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FUY" org.eventb.core.comment="Adds a consumer to a Service Provider.&#10;     This is an action of the System&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="add_consumer_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="add_consumer_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_ug6m4GN0EeqLVsYI4ayt8A" org.eventb.core.comment="Access to a specific record 'r' by a staff.&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="view_general_record_staff">
<org.eventb.core.refinesEvent name="_ug6m4WN0EeqLVsYI4ayt8A" org.eventb.core.target="view_record_staff"/>
<org.eventb.core.guard name="_ug6m4mN0EeqLVsYI4ayt8A" org.eventb.core.generated="false" org.eventb.core.label="grd1_r4" org.eventb.core.predicate="r∈dom(record_general_list)"/>
<org.eventb.core.guard name="_ug6m42N0EeqLVsYI4ayt8A" org.eventb.core.generated="false" org.eventb.core.label="grd2_r4" org.eventb.core.predicate="sp↦record_general_list(r) ∈ general_access_list_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_ug6m5GN0EeqLVsYI4ayt8A" org.eventb.core.comment="Access to a specific record 'r' by a staff.&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="view_restricted_record_staff">
<org.eventb.core.refinesEvent name="_ug7N8GN0EeqLVsYI4ayt8A" org.eventb.core.target="view_record_staff"/>
<org.eventb.core.guard name="_5fvr8GN0EeqLVsYI4ayt8A" org.eventb.core.generated="false" org.eventb.core.label="grd1_r4" org.eventb.core.predicate="r∈dom(record_restricted_list)"/>
<org.eventb.core.guard name="_5fvr8WN0EeqLVsYI4ayt8A" org.eventb.core.generated="false" org.eventb.core.label="grd2_r4" org.eventb.core.predicate="sp↦record_general_list(r) ∈ general_access_list_sp ∨ sp↦record_general_list(r) ∈ restricted_access_list_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FU[" org.eventb.core.comment="This event add a staff to a Service Provider&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="add_staff_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="add_staff_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FU\" org.eventb.core.comment="Adds a new Service Provider to the system&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="add_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="add_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FU]" org.eventb.core.comment="revoke access to a Service Provider&#10;     TODO: enforce&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="revoke_access_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="revoke_access_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FU^" org.eventb.core.comment="Gives restricted access to a Service Provider&#10;     TODO: enforce&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="give_restricted_access_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="give_restricted_access_sp"/>
</org.eventb.core.event>
<org.eventb.core.event name="_vpLwMGA3EeqDMsFs4V7FU_" org.eventb.core.comment="Gives general access to a Service Provider&#10;     TODO: enforce&#10;      " org.eventb.core.convergence="0" org.eventb.core.extended="true" org.eventb.core.generated="false" org.eventb.core.label="give_general_access_sp">
<org.eventb.core.refinesEvent name="'" org.eventb.core.target="give_general_access_sp"/>
</org.eventb.core.event>
<org.eventb.core.variable name="_Z0mFoGNwEeqfwL_WG7Gltw" org.eventb.core.comment="models the list of General Access records" org.eventb.core.generated="false" org.eventb.core.identifier="record_general_list"/>
<org.eventb.core.variable name="_Z0mssGNwEeqfwL_WG7Gltw" org.eventb.core.comment="models the list of Restricted Access records" org.eventb.core.generated="false" org.eventb.core.identifier="record_restricted_list"/>
<org.eventb.core.variable name="_Z0mssWNwEeqfwL_WG7Gltw" org.eventb.core.comment="models the list of Hidden records" org.eventb.core.generated="false" org.eventb.core.identifier="record_hidden_list"/>
<org.eventb.core.invariant name="_Z0mssmNwEeqfwL_WG7Gltw" org.eventb.core.generated="false" org.eventb.core.label="inv1_r4" org.eventb.core.predicate="record_general_list ∈ records ⇸ my_health_report_DB"/>
<org.eventb.core.invariant name="_Z0mss2NwEeqfwL_WG7Gltw" org.eventb.core.generated="false" org.eventb.core.label="inv2_r4" org.eventb.core.predicate="record_restricted_list ∈ records ⇸ my_health_report_DB"/>
<org.eventb.core.invariant name="_Z0mstGNwEeqfwL_WG7Gltw" org.eventb.core.generated="false" org.eventb.core.label="inv3_r4" org.eventb.core.predicate="record_hidden_list ∈ records ⇸ my_health_report_DB"/>
<org.eventb.core.invariant name="_0kKfkGNwEeqfwL_WG7Gltw" org.eventb.core.generated="false" org.eventb.core.label="inv4_r4" org.eventb.core.predicate="partition(records_mhr, record_general_list, record_restricted_list, record_hidden_list)"/>
</org.eventb.core.machineFile>
